<!DOCTYPE html>
<html>
<head>
  <title>Project Photos</title>
  <link rel="stylesheet" href="style.css">
</head>

<body>
  <div class="navbar">
  Construction Management App
</div>
  <h1>Project Photos</h1>

  <div id="gallery">Loading...</div>

  <button onclick="goBack()">Back</button>

  <script type="module">
    import {
      collection, getDocs
    } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";

    const url = new URL(window.location.href);
    const projectId = url.searchParams.get("projectId");

    async function loadPhotos() {
      const gallery = document.getElementById("gallery");
      gallery.innerHTML = "";

      const phasesSnap = await getDocs(
        collection(window.db, "projects", projectId, "phases")
      );

      phasesSnap.forEach(async (phaseDoc) => {
        const phaseId = phaseDoc.id;

        const photosSnap = await getDocs(
          collection(window.db, "projects", projectId, "phases", phaseId, "photos")
        );

        photosSnap.forEach(pdoc => {
          const url = pdoc.data().url;

          const img = document.createElement("img");
          img.src = url;
          img.style.width = "150px";
          img.style.margin = "5px";
          img.style.border = "1px solid #ccc";
          img.style.borderRadius = "6px";

          gallery.appendChild(img);
        });
      });
    }

    function goBack() {
      window.history.back();
    }

    loadPhotos();
  </script>
</body>
</html>
