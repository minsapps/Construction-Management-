<!DOCTYPE html>
<html>
<head>
  <title>Payments</title>
  <link rel="stylesheet" href="style.css">
</head>

<body>
  <div class="navbar">
  Construction Management App
</div>
  <h1>Payments</h1>

  <h2>Add Payment</h2>
  <input id="amount" placeholder="Amount">
  <input id="date" type="date">
  <button onclick="addPayment()">Add Payment</button>
  <p id="result"></p>

  <h2>Existing Payments</h2>
  <div id="paymentList">Loading...</div>

  <button onclick="goBack()">Back</button>

  <script type="module">
    import {
      collection, addDoc, getDocs
    } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";

    const url = new URL(window.location.href);
    const projectId = url.searchParams.get("projectId");

    async function addPayment() {
      const amount = Number(document.getElementById("amount").value);
      const date = document.getElementById("date").value;

      await addDoc(
        collection(window.db, "projects", projectId, "payments"),
        {
          amount,
          date,
          addedBy: window.auth.currentUser.uid
        }
      );

      document.getElementById("result").innerText = "Payment added!";
      loadPayments();
    }

    async function loadPayments() {
      const list = document.getElementById("paymentList");
      list.innerHTML = "";

      const snap = await getDocs(
        collection(window.db, "projects", projectId, "payments")
      );

      snap.forEach(doc => {
        const p = doc.data();

        const div = document.createElement("div");
div.className = "card";
        div.innerHTML = `
          Amount: $${p.amount}<br>
          Date: ${p.date}<br>
        `;

        list.appendChild(div);
      });
    }

    function goBack() {
      window.history.back();
    }

    loadPayments();
  </script>
</body>
</html>
