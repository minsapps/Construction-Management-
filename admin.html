<!DOCTYPE html>
<html>
<head>
  <title>Admin Dashboard</title>
  <link rel="stylesheet" href="style.css">
</head>

<body>
  <body>
  <h1>Admin Dashboard</h1>

  <h2>Create New Project</h2>
  <input id="projectName" placeholder="Project Name (Example: 123 Main St)">
  <input id="customerId" placeholder="Customer User ID">
  <button onclick="createNewProject()">Create Project</button>
  <p id="projectResult"></p>

  <h2>Existing Projects</h2>
  <div id="projectList">Loading...</div>

  <br><br>
  <button onclick="logout()">Logout</button>

  <script type="module">
    import { signOut } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js";
    import { 
      collection, getDocs, addDoc 
    } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";

    // Logout
    async function logout() {
      await signOut(window.auth);
      window.location.href = "index.html";
    }

    // Create new project
    async function createNewProject() {
      const name = document.getElementById("projectName").value;
      const customer = document.getElementById("customerId").value;

      if (!name || !customer) {
        alert("Please enter project name and customer ID");
        return;
      }

      const docRef = await addDoc(collection(window.db, "projects"), {
        projectName: name,
        customerId: customer,
        startDate: new Date().toISOString(),
        status: "in-progress",
        totalPayments: 0
      });

      document.getElementById("projectResult").innerText =
        "Project created: ID = " + docRef.id;
      
      loadProjects();
    }

    // Load all projects
    async function loadProjects() {
      const list = document.getElementById("projectList");
      list.innerHTML = "";

      const snapshot = await getDocs(collection(window.db, "projects"));

      snapshot.forEach(doc => {
        const data = doc.data();
        const div = document.createElement("div");
        div.style.margin = "10px 0";
        div.style.padding = "10px";
        div.style.background = "#eee";
        div.style.borderRadius = "6px";

       div.innerHTML = `
  <strong>${data.projectName}</strong><br>
  ID: ${doc.id}<br>
  Customer: ${data.customerId}<br>
  Status: ${data.status}<br><br>

  <button onclick="managePhases('${doc.id}')">Phases</button>
  <button onclick="openTasks('${doc.id}')">Tasks</button>
  <button onclick="openPayments('${doc.id}')">Payments</button>
  <button onclick="openPhotos('${doc.id}')">Photos</button>
`;

        list.appendChild(div);
      });
    }

    loadProjects();
    // Redirect to phase manager page
function managePhases(projectId)
function openTasks(projectId) {
  window.location.href = "tasks.html?projectId=" + projectId;
}

function openPayments(projectId) {
  window.location.href = "payments.html?projectId=" + projectId;
}

function openPhotos(projectId) {
  window.location.href = "photos.html?projectId=" + projectId;
}{
  window.location.href = "phases.html?projectId=" + projectId;
}
    <h2>Add Customer Payment</h2>
<input id="payProjectId" placeholder="Project ID">
<input id="payAmount" placeholder="Amount">
<input id="payDate" type="date">
<button onclick="addPayment()">Record Payment</button>
<p id="payResult"></p>

<h2>View Payments by Project</h2>
<input id="viewPayProjectId" placeholder="Project ID">
<button onclick="loadPayments()">Load Payments</button>
<div id="paymentsList"></div>
    // Add a customer payment
async function addPayment() {
  const projectId = document.getElementById("payProjectId").value;
  const amount = Number(document.getElementById("payAmount").value);
  const date = document.getElementById("payDate").value;

  if (!projectId || !amount || !date) {
    alert("All fields required.");
    return;
  }

  await addDoc(
    collection(window.db, "projects", projectId, "payments"),
    {
      amount,
      date,
      addedBy: window.auth.currentUser.uid
    }
  );

  document.getElementById("payResult").innerText = "Payment added!";
}

// Load payments for one project
async function loadPayments() {
  const projectId = document.getElementById("viewPayProjectId").value;
  const list = document.getElementById("paymentsList");
  list.innerHTML = "";

  const snap = await getDocs(
    collection(window.db, "projects", projectId, "payments")
  );

  snap.forEach(doc => {
    const p = doc.data();

    const div = document.createElement("div");
    div.style.background = "#eee";
    div.style.padding = "10px";
    div.style.margin = "10px 0";
    div.style.borderRadius = "6px";

    div.innerHTML = `
      Amount: $${p.amount}<br>
      Date: ${p.date}<br>
    `;

    list.appendChild(div);
  });
}
  </script>
</body>
</body>
</html>
